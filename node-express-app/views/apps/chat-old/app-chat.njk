{% import './macros/sidebar-left.njk' as Auth %}
{% import './macros/chat-contact-sidebar-header.njk' as AuthUser %}
{% import './macros/chat-user.njk' as Chat %} 
{% import './macros/chat-contact.njk' as Contact %}
{% import './macros/chat-history.njk' as History %}
{% import './macros/chats.njk' as Chats%}

<!DOCTYPE html>

<html lang="en" class="light-style layout-navbar-fixed layout-menu-fixed layout-compact" dir="ltr" data-theme="theme-default" data-assets-path="/assets/" data-template="vertical-menu-template">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

        <title>Chat - Apps | Belivoire</title>

        {% include '../../layouts/partials/commons/links.njk' %}

        <!-- Page CSS -->

        <link rel="stylesheet" href="/assets/vendor/css/pages/app-chat.css" />
        <link rel="stylesheet" href="/assets/vendor/libs/animate-css/animate.css" />
        {% include '../../layouts/partials/commons/headerScripts.njk' %}
    </head>

    <body>
        <!-- Layout wrapper -->
        <div class="layout-wrapper layout-content-navbar">
            <div class="layout-container">
                <!-- Menu -->
                {% include '../../layouts/partials/commons/aside.njk' %}

                <!-- / Menu -->

                <!-- Layout container -->
                <div class="layout-page">
                    <!-- Navbar -->

                    {% include '../../layouts/partials/commons/nav.njk' %}

                    <!-- / Navbar -->

                    <!-- Content wrapper -->
                    <div class="content-wrapper">
                        <!-- Content -->

                        <div class="container-xxl flex-grow-1 container-p-y">
                            <div class="app-chat card overflow-hidden">
                                <div class="row g-0">
                                    <!-- Sidebar Left -->
                                    <div class="col app-chat-sidebar-left app-sidebar overflow-hidden" id="app-chat-sidebar-left">
                                        {# {% include './partials/sidebar-left.njk' %} #} {{ Auth.check(user)}}
                                    </div>
                                    <!-- /Sidebar Left-->

                                    <!-- Chat & Contacts -->
                                    <div class="col app-chat-contacts app-sidebar flex-grow-0 overflow-hidden border-end" id="app-chat-contacts">
                                        {% include './partials/chat-contact-sidebar-header.njk' %}

                                        <hr class="container-m-nx m-0" />
                                        <div class="sidebar-body">
                                            <div class="chat-contact-list-item-title">
                                                <h5 class="text-primary mb-0 px-4 pt-3 pb-2">Chats</h5>
                                            </div>
                                            <!-- Chats -->
                                            <ul class="list-unstyled chat-contact-list" id="chat-list">
                                                <li class="chat-contact-list-item chat-list-item-0 d-none">
                                                    <h6 class="text-muted mb-0">No Chats Found</h6>
                                                </li>
                                                {# {% for user in users %} {{ Chat.user(user)}} {% endfor %} #}
                                                 {% include './partials/chat-user.njk' %}
                                            </ul>
                                            <!-- Contacts -->
                                            <ul class="list-unstyled chat-contact-list mb-0" id="contact-list">
                                                {# {% for contact in contacts %} {{ Contact.check(contact)}} {% endfor %}  #}
                                                {% include './partials/chat-contact.njk' %}
                                                
                                            </ul>
                                        </div>
                                    </div>
                                    <!-- /Chat contacts -->

                                    <!-- Chat History -->
                                    <div class="col app-chat-history bg-body">
                                        {# {% include './partials/chat-history.njk' %} #} {# {{ History.current(user, chats)}} #}
                                        <div class="chat-history-wrapper">
                                            <div class="chat-history-header border-bottom">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div class="d-flex overflow-hidden align-items-center">
                                                        <i class="ti ti-menu-2 ti-sm cursor-pointer d-lg-none d-block me-2" data-bs-toggle="sidebar" data-overlay data-target="#app-chat-contacts"></i>
                                                        <div class="flex-shrink-0 avatar" id="selected-chat-user-history-status">
                                                            <img
                                                                src="/assets/img/avatars/2.png"
                                                                alt="Avatar"
                                                                class="rounded-circle"
                                                                data-bs-toggle="sidebar"
                                                                data-overlay
                                                                data-target="#app-chat-sidebar-right"
                                                                id="selected-chat-user-history-avatar"
                                                            />
                                                        </div>
                                                        <div class="chat-contact-info flex-grow-1 ms-2">
                                                            <h6 class="m-0" id="selected-chat-user-history-name">Felecia Rower</h6>
                                                            <small class="user-status text-muted" id="selected-chat-user-history-job-title">NextJS developer</small>
                                                        </div>
                                                    </div>
                                                    <div class="d-flex align-items-center">
                                                        <i class="ti ti-phone-call cursor-pointer d-sm-block d-none me-3"></i>
                                                        <i class="ti ti-video cursor-pointer d-sm-block d-none me-3"></i>
                                                        <i class="ti ti-search cursor-pointer d-sm-block d-none me-3"></i>
                                                        <div class="dropdown d-flex align-self-center">
                                                            <button class="btn p-0" type="button" id="chat-header-actions" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                <i class="ti ti-dots-vertical"></i>
                                                            </button>
                                                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="chat-header-actions">
                                                                <a class="dropdown-item" href="javascript:void(0);">View Contact</a>
                                                                <a class="dropdown-item" href="javascript:void(0);">Mute Notifications</a>
                                                                <a class="dropdown-item" href="javascript:void(0);">Block Contact</a>
                                                                <a class="dropdown-item" href="javascript:void(0);">Clear Chat</a>
                                                                <a class="dropdown-item" href="javascript:void(0);">Report</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="chat-history-body bg-body">
                                                {# <ul class="list-unstyled chat-history" id="selected-chat-user-chats">
                                                </ul> #}
                                                {%  include './partials/chats.njk' %}
                                            </div>
                                            <!-- Chat message form -->
                                            <div class="chat-history-footer shadow-sm">
                                                <form class="form-send-message d-flex justify-content-between align-items-center">
                                                    <input class="form-control message-input border-0 me-3 shadow-none" placeholder="Type your message here" />
                                                    <div class="message-actions d-flex align-items-center">
                                                        <i class="speech-to-text ti ti-microphone ti-sm cursor-pointer"></i>
                                                        <label for="attach-doc" class="form-label mb-0">
                                                            <i class="ti ti-photo ti-sm cursor-pointer mx-3"></i>
                                                            <input type="file" id="attach-doc" hidden />
                                                        </label>
                                                        <button class="btn btn-primary d-flex send-msg-btn">
                                                            <i class="ti ti-send me-md-1 me-0"></i>
                                                            <span class="align-middle d-md-inline-block d-none">Send</span>
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /Chat History -->

                                    <!-- Sidebar Right -->
                                    <div class="col app-chat-sidebar-right app-sidebar overflow-hidden" id="app-chat-sidebar-right">
                                        {% include './partials/sidebar-right.njk' %}
                                    </div>
                                    <!-- /Sidebar Right -->

                                    <div class="app-overlay"></div>
                                </div>
                            </div>
                        </div>
                        <!-- / Content -->

                        <!-- Footer -->
                        {% include '../../layouts/partials/commons/footer.njk' %}
                        <!-- / Footer -->

                        <div class="content-backdrop fade"></div>
                    </div>
                    <!-- Content wrapper -->
                </div>
                <!-- / Layout page -->
            </div>

            <!-- Overlay -->
            <div class="layout-overlay layout-menu-toggle"></div>

            <!-- Drag Target Area To SlideIn Menu On Small Screens -->
            <div class="drag-target"></div>
        </div>
        <!-- / Layout wrapper -->

        <!-- Core JS -->
        <!-- build:js assets/vendor/js/core.js -->

        {% include '../../layouts/partials/commons/coreScripts.njk' %}

        <!-- endbuild -->

        <!-- Vendors JS -->
        <script src="/assets/vendor/libs/bootstrap-maxlength/bootstrap-maxlength.js"></script>

        <!-- Main JS -->
        {% include '../../layouts/partials/commons/mainScripts.njk' %}

       <script src="/assets/vendor/libs/axios/1-5-0/axios.min.js"></script>
        <script src="/assets/vendor/libs/socket-io/4-4-1/socket.io.min.js"></script>
        <script>
            if(!window.user) window.user = {{ user | dump | safe}}
            if(!window.contacts) window.contacts = {{ contacts | dump | safe}}
            if(!window.users) window.users = {{ users | dump | safe}}
            if(!window.chats) window.chats = {{ chats | dump | safe}}
            window.localStorage.setItem('user', JSON.stringify(user));
        </script>
        
        <!-- Page JS -->
        <script src="/assets/js/app-chat.js"></script>
        <script src="/assets/js/is-online.js"></script>
    </body>
</html>
